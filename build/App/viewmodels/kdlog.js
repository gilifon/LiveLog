define(["viewmodels/shell"],function(g){this.logForCall=ko.observableArray(),this.statisticsList=ko.observableArray(),this.modeData=ko.observableArray(),this.bandData=ko.observableArray(),this.refData=ko.observableArray(),this.unsordetStations=ko.observableArray([]),this.isWwffOnly=ko.observable(!0),this.totalQSO=ko.observable(0),this.uniqueCall=ko.observable(0),this.callsign=ko.observable(""),this.didNotWork=ko.observable(!1),this.Capernaum=ko.observableArray(),this.Caesarea=ko.observableArray(),this.Jerusalem=ko.observableArray(),this.Latrun=ko.observableArray(),this.Massada=ko.observableArray(),this.Operators=ko.observableArray(),this.SES=ko.observableArray(),this.entitled=ko.observableArray(),this.isEligable=ko.observable(!1),this.cw=ko.observable(!1),this.ssb=ko.observable(!1),this.digi=ko.observable(!1),this.mix=ko.observable(!1);var e=this;this.GetLogForCall=function(){""!=callsign()&&$.ajax({type:"POST",url:"./Server/GetLogForCall.php",data:{info:{call:callsign()}}}).done(function(g){return""==g.data?(logForCall([]),didNotWork(!0),isEligable(!1),void 0):(logForCall(g.data),cw(1==g.eligability.CW),ssb(1==g.eligability.SSB),digi(1==g.eligability.DIGI),mix(1==g.eligability.MIX),isEligable(1==g.eligability.SSB||1==g.eligability.DIGI||1==g.eligability.CW||1==g.eligability.MIX),didNotWork(!1),void 0)}).error(function(){logForCall([]),didNotWork(!0),isEligable(!1)})},this.GetLogForSES=function(g){return ko.observableArray(Enumerable.From(logForCall()).Where(function(e){return e.ses_callsign==g}).ToArray())},this.GetOperators=function(){$.ajax({type:"POST",url:"./Server/GetOperators.php"}).done(function(g){""!=g&&Operators(g)}).error(function(){})},this.GetDistinctSES=function(){return ko.observableArray(Enumerable.From(Operators()).Distinct("$.ses_callsign").ToArray())},this.GetOperatorsForSES=function(g){return ko.observableArray(Enumerable.From(Operators()).Where(function(e){return e.ses_callsign==g}).ToArray())},this.IsSectionExist=function(g){var e=Enumerable.From(logForCall).Where(function(e){return e.section==g}).ToArray();return e.length},this.loadData=function(){$.ajax({type:"POST",url:"./Server/GetAllLog.php"}).done(function(g){statisticsList(g),drawChart()}).error(function(){statisticsList([])})},this.loadEntitled=function(){$.ajax({type:"POST",url:"./Server/GetEntitled.php"}).done(function(g){entitled(g)}).error(function(){entitled([])})},this.drawChart=function(){modeData([]),bandData([]),refData([]),whereClause=function(){return!0},totalQSO(Enumerable.From(statisticsList()).Where(whereClause).Count()),uniqueCall(Enumerable.From(statisticsList()).Where(whereClause).Select("$.callsign").Distinct().Count()),Enumerable.From(statisticsList()).Where(whereClause).Select("$.mode").Distinct().OrderByDescending().ForEach(function(g){modeData.push({c:[{v:g,f:null},{v:Enumerable.From(statisticsList()).Where(function(e){return e.mode==g}).Where(whereClause).ToArray().length,f:null}]})});var g={cols:[{id:"",label:"Mode",pattern:"",type:"string"},{id:"",label:"QSOs",pattern:"",type:"number"}],rows:modeData()},e={width:"100%",height:320,colors:["#00ccff","#cc33ff","#ff0066","#ffcc00","#66ff33","#00ccff"]};Enumerable.From(statisticsList()).Where(whereClause).Select("$.band").Distinct().OrderBy().ForEach(function(g){bandData.push({c:[{v:g,f:null},{v:Enumerable.From(statisticsList()).Where(function(e){return e.band==g}).Where(whereClause).ToArray().length,f:null}]})});var o={cols:[{id:"",label:"Band",pattern:"",type:"string"},{id:"",label:"QSOs",pattern:"",type:"number"}],rows:bandData()},a={width:"100%",height:320,colors:["#3366ff","#cc00cc","#ff5050","#cc9900","#33cc33","#33cccc","#6666ff","#ff9933"]};this.unsordetStations=ko.observableArray([]),refData.push(["Station","QSOs"]),Enumerable.From(statisticsList()).Where(whereClause).Select("$.ses_callsign").OrderBy().Distinct().ForEach(function(g){var e=Enumerable.From(statisticsList()).Where(function(e){return e.ses_callsign==g}).Where(whereClause).ToArray().length;null==g&&(g=" "),refData.push([g,e])});var n=google.visualization.arrayToDataTable(refData()),L=new google.visualization.DataView(n);L.setColumns([0,1,{calc:"stringify",sourceColumn:1,type:"string",role:"annotation"}]);var t={title:"QSOs per Station",height:440,bar:{groupWidth:"95%"},legend:{position:"none"}},s=new google.visualization.ColumnChart(document.getElementById("ref_chart"));s.draw(L,t);var l=new google.visualization.PieChart(document.getElementById("mode_chart"));l.draw(new google.visualization.DataTable(g),e);var p=new google.visualization.PieChart(document.getElementById("band_chart"));return p.draw(new google.visualization.DataTable(o),a),!0};var o={activate:function(){google.charts.load("current",{packages:["corechart","bar"]}),google.charts.setOnLoadCallback(loadData),loadEntitled(),GetOperators(),g.selectedMainMenu("sections")},compositionComplete:function(){jwerty.key("enter",function(){GetLogForCall()},e)},shell:g};return o});