define(["durandal/system","durandal/viewEngine"],function(e,g){function n(e,g){for(var n=0;n<e.length;n++){var o=e[n],a=o.getAttribute("data-view");if(a==g)return o}}function o(e){return(e+"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1")}return{useConvention:function(e,g,n){e=e||"viewmodels",g=g||"views",n=n||g;var a=new RegExp(o(e),"gi");this.convertModuleIdToViewId=function(e){return e.replace(a,g)},this.translateViewIdToArea=function(e,g){return g&&"partial"!=g?n+"/"+g+"/"+e:n+"/"+e}},locateViewForObject:function(g,n,o){var a;if(g.getView&&(a=g.getView()))return this.locateView(a,n,o);if(g.viewUrl)return this.locateView(g.viewUrl,n,o);var t=e.getModuleId(g);return t?this.locateView(this.convertModuleIdToViewId(t),n,o):this.locateView(this.determineFallbackViewId(g),n,o)},convertModuleIdToViewId:function(e){return e},determineFallbackViewId:function(e){var g=/function (.{1,})\(/,n=g.exec(e.constructor.toString()),o=n&&n.length>1?n[1]:"";return"views/"+o},translateViewIdToArea:function(e){return e},locateView:function(o,a,t){if("string"==typeof o){var L;if(L=g.isViewUrl(o)?g.convertViewUrlToViewId(o):o,a&&(L=this.translateViewIdToArea(L,a)),t){var s=n(t,L);if(s)return e.defer(function(e){e.resolve(s)}).promise()}return g.createView(L)}return e.defer(function(e){e.resolve(o)}).promise()}}});