define(["durandal/system","durandal/binder","knockout"],function(e,g,n){function a(e){var g=e[0];return"_"===g||"$"===g}function o(g){if(!g||e.isElement(g)||g.ko===n||g.jquery)return!1;var a=w.call(g);return-1==i.indexOf(a)&&!(g===!0||g===!1)}function t(e,g){var n=e.__observable__,a=!0;if(!n||!n.__full__){n=n||(e.__observable__={}),n.__full__=!0,r.forEach(function(n){e[n]=function(){a=!1;var e=f[n].apply(g,arguments);return a=!0,e}}),c.forEach(function(n){e[n]=function(){a&&g.valueWillMutate();var o=d[n].apply(e,arguments);return a&&g.valueHasMutated(),o}}),u.forEach(function(n){e[n]=function(){for(var o=0,t=arguments.length;t>o;o++)L(arguments[o]);a&&g.valueWillMutate();var s=d[n].apply(e,arguments);return a&&g.valueHasMutated(),s}}),e.splice=function(){for(var n=2,o=arguments.length;o>n;n++)L(arguments[n]);a&&g.valueWillMutate();var t=d.splice.apply(e,arguments);return a&&g.valueHasMutated(),t};for(var o=0,t=e.length;t>o;o++)L(e[o])}}function L(g){var L,s;if(o(g)&&(L=g.__observable__,!L||!L.__full__)){if(L=L||(g.__observable__={}),L.__full__=!0,e.isArray(g)){var p=n.observableArray(g);t(g,p)}else for(var m in g)a(m)||L[m]||(s=g[m],e.isFunction(s)||l(g,m,s));h&&e.log("Converted",g)}}function s(e,g,n){var a;e(g),a=e.peek(),n?a.destroyAll||(a||(a=[],e(a)),t(a,e)):L(a)}function l(g,a,o){var l,p,m=g.__observable__||(g.__observable__={});if(void 0===o&&(o=g[a]),e.isArray(o))l=n.observableArray(o),t(o,l),p=!0;else if("function"==typeof o){if(!n.isObservable(o))return null;l=o}else e.isPromise(o)?(l=n.observable(),o.then(function(g){if(e.isArray(g)){var a=n.observableArray(g);t(g,a),g=a}l(g)})):(l=n.observable(o),L(o));return Object.defineProperty(g,a,{configurable:!0,enumerable:!0,get:l,set:n.isWriteableObservable(l)?function(g){g&&e.isPromise(g)?g.then(function(g){s(l,g,e.isArray(g))}):s(l,g,p)}:void 0}),m[a]=l,l}function p(g,n,a){var o,t=this,L={owner:g,deferEvaluation:!0};return"function"==typeof a?L.read=a:("value"in a&&e.error('For ko.defineProperty, you must not specify a "value" for the property. You must provide a "get" function.'),"function"!=typeof a.get&&e.error('For ko.defineProperty, the third parameter must be either an evaluator function, or an options object containing a function called "get".'),L.read=a.get,L.write=a.set),o=t.computed(L),g[n]=o,l(g,n,o)}var m,w=Object.prototype.toString,i=["[object Function]","[object String]","[object Boolean]","[object Number]","[object Date]","[object RegExp]"],r=["remove","removeAll","destroy","destroyAll","replace"],c=["pop","reverse","sort","shift","splice"],u=["push","unshift"],d=Array.prototype,f=n.observableArray.fn,h=!1;return m=function(e,g){var a,o,t;return e?(a=e.__observable__,a&&(o=a[g])?o:(t=e[g],n.isObservable(t)?t:l(e,g,t))):null},m.defineProperty=p,m.convertProperty=l,m.convertObject=L,m.install=function(e){var n=g.binding;g.binding=function(e,g,a){a.applyBindings&&!a.skipConversion&&L(e),n(e,g)},h=e.logConversion},m});