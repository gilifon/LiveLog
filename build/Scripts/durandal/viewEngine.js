define(["durandal/system","jquery"],function(e,g){var n;return n=g.parseHTML?function(e){return g.parseHTML(e)}:function(e){return g(e).get()},{viewExtension:".html",viewPlugin:"text",isViewUrl:function(e){return-1!==e.indexOf(this.viewExtension,e.length-this.viewExtension.length)},convertViewUrlToViewId:function(e){return e.substring(0,e.length-this.viewExtension.length)},convertViewIdToRequirePath:function(e){return this.viewPlugin+"!"+e+this.viewExtension},parseMarkup:n,processMarkup:function(e){var g=this.parseMarkup(e);return this.ensureSingleElement(g)},ensureSingleElement:function(e){if(1==e.length)return e[0];for(var n=[],o=0;o<e.length;o++){var a=e[o];if(8!=a.nodeType){if(3==a.nodeType){var t=/\S/.test(a.nodeValue);if(!t)continue}n.push(a)}}return n.length>1?g(n).wrapAll('<div class="durandal-wrapper"></div>').parent().get(0):n[0]},createView:function(g){var n=this,o=this.convertViewIdToRequirePath(g);return e.defer(function(a){e.acquire(o).then(function(e){var o=n.processMarkup(e);o.setAttribute("data-view",g),a.resolve(o)}).fail(function(e){n.createFallbackView(g,o,e).then(function(e){e.setAttribute("data-view",g),a.resolve(e)})})}).promise()},createFallbackView:function(g,n){var o=this,a='View Not Found. Searched for "'+g+'" via path "'+n+'".';return e.defer(function(e){e.resolve(o.processMarkup('<div class="durandal-view-404">'+a+"</div>"))}).promise()}}});